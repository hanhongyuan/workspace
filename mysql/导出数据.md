
mysqldump -ugiftuser -ptfDkWQ5xbcJr statistic > statistic.sql

mysqldump -h192.168.1.23 --skip-add-locks -P13000 -uroot -psjfx-2018 --all-databases | gzip > dbback.sql.gz

time=`date +%Y%m%d-%H%M%S`
databasestr=""
mysqldump -hrm-bp1qn4bl8d8p9mnm4.mysql.rds.aliyuncs.com --skip-add-locks -ubackuper -psjfx@2018 --databases $databasestr | gzip > db-$time.sql.gz





 mysqldump -hrm-bp1dt9mpug49w8c45jo.mysql.rds.aliyuncs.com -ujira -psjfx@2018JIRA sjfxjira > sjfxjira.sql



mysql -hrm-bp1qn4bl8d8p9mnm44o.mysql.rds.aliyuncs.com -P3369 -ujira -psjfx@2018JIRA sjfxjira < sjfxjira.sql


mysqldump -hrm-bp1dt9mpug49w8c45jo.mysql.rds.aliyuncs.com -uroot -pSjfx@2176109 platform > platform.sql

platform
platform

mysql -hrm-bp1qn4bl8d8p9mnm44o.mysql.rds.aliyuncs.com -P3369 -uapp -pApp-2176109 platform < platformsql.sql

CREATE DATABASE platform

CREATE USER 'app'@'%' IDENTIFIED BY 'App-2176109';

GRANT ALL ON platform.* TO 'app'@'%';


1. initsql
use mysql;
DROP USER  app;
DROP DATABASE platform;
CREATE DATABASE platform;
CREATE USER 'app'@'%' IDENTIFIED BY 'App-2176109';
GRANT ALL ON platform.* TO 'app'@'%';

2. exp
mysqldump -hrm-bp1dt9mpug49w8c45jo.mysql.rds.aliyuncs.com -uroot -pSjfx@2176109 platform > platform.sql

sed '/GTID_PURGED/N;s/,\n/,/' statistic.sql | grep -iv 'set @@global' > statisticgrep.sql
rm -f statistic.sql
sed '/GTID_PURGED/N;s/,\n/,/' statisticgrep.sql | grep -iv 'set @@session' > statistic.sql
sed '1 iSET FOREIGN_KEY_CHECKS=0;' -i statistic.sql
echo 'SET FOREIGN_KEY_CHECKS=1;' >> statistic.sql
rm -f statisticgrep.sql

rm -f platformgrep.sql

3. imp
mysql -hrm-bp1qn4bl8d8p9mnm44o.mysql.rds.aliyuncs.com -P3369 -uapp -pApp-2176109 platform < platformnew.sql
rm -f platformnew.sql

"MysqlConnection": "Server=rm-bp1qn4bl8d8p9mnm44o.mysql.rds.aliyuncs.com;Port=3369;Database=platform;Uid=app;Pwd=App-2176109;persistsecurityinfo=True;SslMode=none;",

statistic

gunzip statistic.sql.gz

sed '/GTID_PURGED/N;s/,\n/,/' statistic.sql | grep -iv 'set @@global' > statisticgrep.sql
rm -f statistic.sql
sed '/GTID_PURGED/N;s/,\n/,/' statisticgrep.sql | grep -iv 'set @@session' > statistic.sql
sed '1 iSET FOREIGN_KEY_CHECKS=0;' -i statistic.sql
echo 'SET FOREIGN_KEY_CHECKS=1;' >> statistic.sql
rm -f statisticgrep.sql
vim statistic.sql


mysql -h192.168.1.22 -P13000 -usjfx -p123456 statistic_prod < statistic.sql

mysql -h192.168.1.23 -P13000 -usjfx -p123456 statistic_prod < statistic.sql

mysql -usjfx -p123456 statistic < 

mysql -hrm-bp1qn4bl8d8p9mnm4.mysql.rds.aliyuncs.com -ustatisticuser -pxP9xxieE4wDg statistic < statistic.sql

statisticuser

vim statistic.sql

105810

statistic

sed '/GTID_PURGED/N;s/,\n/,/' statistic.sql | grep -iv 'set @@global' > statisticgrep.sql
rm -f statistic.sql
sed '/GTID_PURGED/N;s/,\n/,/' statisticgrep.sql | grep -iv 'set @@session' > statistic.sql
sed '1 iSET FOREIGN_KEY_CHECKS=0;' -i statistic.sql
echo 'SET FOREIGN_KEY_CHECKS=1;' >> statistic.sql
rm -f statisticgrep.sql
mysql -h192.168.1.22 -P13000 -usjfx -p123456 statistic < statistic.sql

rm -f statistic.sql



yum update perl -y && \
yum update perl-ExtUtils-Embed -y && \
yum update perl-ExtUtils-Install -y && \
yum update perl-Pod-Escapes -y && \
yum update perl-devel -y && \
yum update perl-libs -y && \
yum update perl-macros -y 
